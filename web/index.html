<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>Lava Lamp Flutter BG</title>
  <style>
    html,
    body {
      margin: 0;
      height: 100%;
      overflow: hidden;
    }

    #bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      z-index: -1;
      /* behind Flutter app */
    }

    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }
  </style>
</head>

<body>
  <div id="bg"></div>

  <!-- Your Flutter app -->
  <script src="main.dart.js" type="application/javascript"></script>

  <script>
    const fragShader = `
  precision mediump float;
  uniform vec2 iResolution;
  uniform float iTime;

  #define filmGrainIntensity 0.1

  mat2 Rot(float a) {
    float s = sin(a);
    float c = cos(a);
    return mat2(c, -s, s, c);
  }

  vec2 hash(vec2 p) {
    p = vec2(dot(p, vec2(2127.1, 81.17)), dot(p, vec2(1269.5, 283.37)));
    return fract(sin(p)*43758.5453);
  }

  float noise(in vec2 p) {
    vec2 i = floor(p);
    vec2 f = fract(p);
    vec2 u = f*f*(3.0-2.0*f);

    float n = mix(mix(dot(-1.0+2.0*hash(i + vec2(0.0, 0.0)), f - vec2(0.0, 0.0)),
                      dot(-1.0+2.0*hash(i + vec2(1.0, 0.0)), f - vec2(1.0, 0.0)), u.x),
                  mix(dot(-1.0+2.0*hash(i + vec2(0.0, 1.0)), f - vec2(0.0, 1.0)),
                      dot(-1.0+2.0*hash(i + vec2(1.0, 1.0)), f - vec2(1.0, 1.0)), u.x), u.y);
    return 0.5 + 0.5*n;
  }

  float filmGrainNoise(in vec2 uv) {
    return length(hash(vec2(uv.x, uv.y)));
  }

  void main(void) {
    vec2 uv = gl_FragCoord.xy / iResolution.xy;
    float aspectRatio = iResolution.x / iResolution.y;
    vec2 tuv = uv - .5;

    float degree = noise(vec2(iTime*.05, tuv.x*tuv.y));

    tuv.y *= 1./aspectRatio;
    tuv *= Rot(radians((degree-.5)*720.+180.));
    tuv.y *= aspectRatio;

    float frequency = 5.;
    float amplitude = 30.;
    float speed = iTime * 2.;
    tuv.x += sin(tuv.y*frequency+speed)/amplitude;
    tuv.y += sin(tuv.x*frequency*1.5+speed)/(amplitude*.5);

    vec3 amberYellow = vec3(299,186,137)/255.;
    vec3 deepBlue = vec3(49,98,238)/255.;
    vec3 pink = vec3(246,146,146)/255.;
    vec3 blue = vec3(89,181,243)/255.;
    vec3 purpleHaze = vec3(105,49,245)/255.;
    vec3 swampyBlack = vec3(32,42,50)/255.;
    vec3 persimmonOrange = vec3(233,51,52)/255.;
    vec3 darkAmber = vec3(233,160,75)/255.;

    float cycle = sin(iTime * 0.5);
    float t = (sign(cycle) * pow(abs(cycle), 0.6) + 1.) / 2.;
    vec3 color1 = mix(amberYellow, purpleHaze, t);
    vec3 color2 = mix(deepBlue, swampyBlack, t);
    vec3 color3 = mix(pink, persimmonOrange, t);
    vec3 color4 = mix(blue, darkAmber, t);

    vec3 layer1 = mix(color3, color2, smoothstep(-.3, .2, (tuv*Rot(radians(-5.))).x));
    vec3 layer2 = mix(color4, color1, smoothstep(-.3, .2, (tuv*Rot(radians(-5.))).x));
    vec3 color = mix(layer1, layer2, smoothstep(.5, -.3, tuv.y));

    color = color - filmGrainNoise(uv) * filmGrainIntensity;
    gl_FragColor = vec4(color,1.0);
  }
  `;

    const vertShader = `
  attribute vec2 a_position;
  void main() {
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
  `;

    const canvas = document.createElement("canvas");
    document.getElementById("bg").appendChild(canvas);
    const gl = canvas.getContext("webgl");

    function compile(src, type) {
      const s = gl.createShader(type);
      gl.shaderSource(s, src);
      gl.compileShader(s);
      if (!gl.getShaderParameter(s, gl.COMPILE_STATUS)) {
        console.error(gl.getShaderInfoLog(s));
      }
      return s;
    }

    const vs = compile(vertShader, gl.VERTEX_SHADER);
    const fs = compile(fragShader, gl.FRAGMENT_SHADER);
    const prog = gl.createProgram();
    gl.attachShader(prog, vs);
    gl.attachShader(prog, fs);
    gl.linkProgram(prog);
    gl.useProgram(prog);

    const posLoc = gl.getAttribLocation(prog, "a_position");
    const buffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
      -1, -1, 1, -1, -1, 1,
      -1, 1, 1, -1, 1, 1
    ]), gl.STATIC_DRAW);
    gl.enableVertexAttribArray(posLoc);
    gl.vertexAttribPointer(posLoc, 2, gl.FLOAT, false, 0, 0);

    const resLoc = gl.getUniformLocation(prog, "iResolution");
    const timeLoc = gl.getUniformLocation(prog, "iTime");

    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      gl.viewport(0, 0, canvas.width, canvas.height);
    }
    window.addEventListener("resize", resize);
    resize();

    function render(time) {
      gl.uniform2f(resLoc, canvas.width, canvas.height);
      gl.uniform1f(timeLoc, time * 0.001);
      gl.drawArrays(gl.TRIANGLES, 0, 6);
      requestAnimationFrame(render);
    }
    requestAnimationFrame(render);
  </script>
</body>

</html>